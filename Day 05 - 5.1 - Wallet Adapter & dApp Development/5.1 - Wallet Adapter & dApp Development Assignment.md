# 5.1 - Wallet Adapter & dApp Development — Assignment

> **Slides**: https://petal-estimate-4e9.notion.site/Wallet-adapter-860feade9cb940cea696eedf4fc61251
> **Notes**: https://feather-lion-ff2.notion.site/Week-5-1-797e1e0b818a43138146e362a4a3cc77
> **Reference Project**: https://github.com/27manavgandhi/Solana-Web3-Wallet-Interaction-App

---

## Core Assignment

### Task 1 — Show User Token Balances

Build a component that fetches and displays all SPL tokens held by the connected wallet.

```bash
npm install @solana/spl-token
```

Steps:
1. Use `useWallet()` to get the connected wallet's `publicKey`
2. Use `connection.getParsedTokenAccountsByOwner()` to fetch all token accounts
3. Parse each account's `mint`, `tokenAmount.uiAmount`, and `decimals`
4. Display a list of tokens with their mint address and balance

```jsx
import { useConnection, useWallet } from "@solana/wallet-adapter-react";
import { TOKEN_PROGRAM_ID } from "@solana/spl-token";
import { useState } from "react";

export function ShowTokenBalances() {
  const { connection } = useConnection();
  const { publicKey } = useWallet();
  const [tokens, setTokens] = useState([]);

  async function fetchTokens() {
    const accounts = await connection.getParsedTokenAccountsByOwner(publicKey, {
      programId: TOKEN_PROGRAM_ID,
    });

    const parsed = accounts.value.map(({ account }) => {
      const info = account.data.parsed.info;
      return {
        mint: info.mint,
        balance: info.tokenAmount.uiAmount,
        decimals: info.tokenAmount.decimals,
      };
    });

    setTokens(parsed);
  }

  return (
    <div>
      <button onClick={fetchTokens}>Load Tokens</button>
      {tokens.map((t, i) => (
        <div key={i}>
          <p>Mint: {t.mint}</p>
          <p>Balance: {t.balance}</p>
        </div>
      ))}
    </div>
  );
}
```

---

### Task 2 — Let User Transfer Tokens

Build a component that lets the connected wallet transfer SPL tokens to another address.

Steps:
1. Input fields: destination address, mint address, amount
2. Use `getOrCreateAssociatedTokenAccount` for sender and receiver ATAs
3. Use `transfer()` from `@solana/spl-token` or build the instruction manually
4. Sign via `wallet.sendTransaction()`

```jsx
import { useConnection, useWallet } from "@solana/wallet-adapter-react";
import { getOrCreateAssociatedTokenAccount, createTransferInstruction } from "@solana/spl-token";
import { PublicKey, Transaction } from "@solana/web3.js";

export function TransferTokens() {
  const { connection } = useConnection();
  const wallet = useWallet();

  async function handleTransfer() {
    const mintAddress = new PublicKey(document.getElementById("mint").value);
    const toAddress = new PublicKey(document.getElementById("to").value);
    const amount = parseInt(document.getElementById("amount").value);

    // Get source ATA (sender)
    const fromATA = await connection.getParsedTokenAccountsByOwner(wallet.publicKey, { mint: mintAddress });
    const fromATAAddress = fromATA.value[0].pubkey;

    // Get/create destination ATA
    // Note: getOrCreateAssociatedTokenAccount requires a Signer — use a transaction instruction instead
    const toATA = PublicKey.findProgramAddressSync(
      [toAddress.toBuffer(), TOKEN_PROGRAM_ID.toBuffer(), mintAddress.toBuffer()],
      ASSOCIATED_TOKEN_PROGRAM_ID
    )[0];

    const tx = new Transaction().add(
      createTransferInstruction(fromATAAddress, toATA, wallet.publicKey, amount)
    );

    const sig = await wallet.sendTransaction(tx, connection);
    alert("Transfer sent: " + sig);
  }

  return (
    <div>
      <input id="mint" type="text" placeholder="Token Mint Address" />
      <input id="to" type="text" placeholder="Recipient Address" />
      <input id="amount" type="text" placeholder="Amount (raw units)" />
      <button onClick={handleTransfer}>Transfer Tokens</button>
    </div>
  );
}
```

---

## Challenges / Things to Learn

### Challenge 1 — Extract Token Metadata

When showing token balances, display the **ticker** and **logo** of each token:

1. Use the Metaplex token metadata program to fetch on-chain metadata for each mint
2. Parse the `uri` from the metadata account → fetch the JSON → extract `name`, `symbol`, `image`
3. Display the image and symbol next to each token balance

```bash
npm install @metaplex-foundation/mpl-token-metadata
```

Helpful resources:
- https://developers.metaplex.com/token-metadata
- https://solscan.io → search any token mint → check metadata tab

---

### Challenge 2 — Use @solana/spl-token from Frontend Only

Rebuild the token transfer using `@solana/spl-token` purely from the browser:
- No backend, no server-side signing
- All wallet interactions go through `useWallet().sendTransaction()`
- Build the transaction manually using `createTransferInstruction`

---

## Very Hard Assignment

Add payments to the **Muzer** project:
https://github.com/code100x/muzer

This involves:
1. Integrating Solana Wallet Adapter into the Muzer UI
2. Building a "pay to add song" flow — user signs a SOL transfer to a treasury wallet
3. On transaction confirmation, the song gets added to the queue
4. Verify the transaction on-chain before accepting the song request

---

## Reference Project

The full working solution is live at:
- **GitHub**: https://github.com/27manavgandhi/Solana-Web3-Wallet-Interaction-App
- Features: Connect wallet, Airdrop SOL, Show balance, Send transaction, Sign message
