# 3.1 - Creating a Web Based Wallet & RPCs

> **Course**: 100xDevs Cohort 3.0 ‚Äî Web3 Track  
> **Instructor**: Harkirat Singh  
> **Platform**: DailyCode (projects.100xdevs.com)  
> **Live Project**: [OptiMask Wallet](https://optimask-wallet-chi.vercel.app/)  
> **Project Repo**: [GitHub - OptiMask-Wallet](https://github.com/27manavgandhi/OptiMask-Wallet)

---

## üìå Context / What We Already Know

By Day 3, we had already covered:

1. **Hashing** ‚Äî SHA-256, one-way functions
2. **Encryption (EDDSA, ECDSA)** ‚Äî Public and Private Keys
3. **HD Wallets** ‚Äî Hierarchical Deterministic Wallets, mnemonics, derivation paths

Now we move to **practically building** a web-based wallet and understanding how to **talk to the blockchain** using RPCs.

---

## üó∫Ô∏è What We're Covering Today

1. **Keccak-256** ‚Äî Ethereum's hashing algorithm
2. **RPC, JSON-RPC** ‚Äî How apps communicate with the blockchain
3. **RPC Server** ‚Äî What it is, providers
4. **Wei & Lamports** ‚Äî Smallest units of ETH and SOL
5. **Common RPC calls on Solana & Ethereum**
6. **Building a web-based wallet** in React

---

## 1. Keccak-256

**Try it out**: https://emn178.github.io/online-tools/keccak_256.html

### Properties of Keccak-256

| Property | Description |
|----------|-------------|
| **Collision Resistance** | Extremely hard to find two inputs with the same hash output. Using block hash + timestamp + nonce reduces collision probability further. |
| **Pre-image Resistance** | Nearly impossible to reverse the hash and find the original input. Brute-force is possible but cost-prohibitive with strong keys. |
| **Key Length** | Outputs a 256-bit hash value ‚Äî enormous output space, resistant to brute-force. |
| **Implementation** | Must use a secure, up-to-date implementation free from known vulnerabilities. |

### ETH Address Generation

```
generateKeyPair() ‚Üí public key ‚Üí [Keccak-256] ‚Üí 32-byte string
                                                     ‚Üì
                                               Last 20 bytes
                                                     ‚Üì
                                             0x8BCd4591F46e809B15A490F5C6eD031FDDE0bee0
```

Steps:
1. Generate a public key using elliptic curve cryptography (secp256k1)
2. Hash the public key using Keccak-256 ‚Üí 32-byte hash
3. Take the **last 20 bytes** of the hash
4. Prefix with `0x` ‚Üí this is your Ethereum address

> Reference: [ethers.js address derivation](https://github.com/ethers-io/ethers.js/blob/main/src.ts/transaction/address.ts#L12)

### Solana Address ‚Äî Different!

Solana public keys are **32 bytes** (e.g., `5W4oGgDHqir3KNEcmiMn6tNHmbWjC7PgW1lsk4AwWbpe`)  
**No need for hashing or chopping** ‚Äî the raw public key IS the address.

---

## 2. RPC, JSON-RPC

### What is JSON-RPC?

JSON-RPC is a **remote procedure call (RPC) protocol** encoded in JSON. It allows communication between a client and a server over a network.

As a blockchain user, you interact with the blockchain for **two purposes**:
1. To **send a transaction**
2. To **fetch data** from the blockchain (balances, block info, etc.)

**Both are done using JSON-RPC.**

> JSON RPC Spec: https://www.jsonrpc.org/specification  
> Other RPC types exist: gRPC, tRPC

### JSON-RPC Request Structure

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "method_name",
  "params": ["param1", "param2"]
}
```

---

## 3. RPC Server

An **RPC server** is a service that:
- Listens for JSON-RPC requests from clients
- Processes those requests
- Returns results from the blockchain

It acts as an **intermediary between the blockchain and your application**.

> ‚ö†Ô∏è An RPC server is NOT part of the blockchain network itself ‚Äî it doesn't participate in staking or consensus.

### RPC Providers

You can get your own RPC endpoint from:

| Provider | URL |
|----------|-----|
| Quicknode | https://www.quicknode.com |
| Alchemy | https://www.alchemy.com |
| Helius (Solana) | https://www.helius.dev |
| Infura | https://www.infura.io |

---

## 4. Wei & Lamports (Smallest Units)

### ETH

| Unit | Value |
|------|-------|
| **Wei** | Smallest unit. 1 ETH = 10^18 Wei |
| **Gwei** | Used for gas prices. 1 ETH = 10^9 Gwei |

### Solana

| Unit | Value |
|------|-------|
| **Lamport** | Smallest unit of SOL. 1 SOL = 10^9 Lamports |

```js
const { LAMPORTS_PER_SOL } = require("@solana/web3.js")
console.log(LAMPORTS_PER_SOL) // 1000000000
```

---

## 5. Common RPC Calls on Solana

```json
// Get account info
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "getAccountInfo",
  "params": ["Eg4F6LW8DD3SvFLLigYJBFvRnXSBiLZYYJ3KEePDL95Q"]
}

// Get balance
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "getBalance",
  "params": ["Eg4F6LW8DD3SvFLLigYJBFvRnXSBiLZYYJ3KEePDL95Q"]
}

// Get transaction count
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "getTransactionCount"
}
```

---

## 6. Common RPC Calls on Ethereum

```json
// Get balance
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "eth_getBalance",
  "params": ["0xaeaa570b50ad00377ff8add27c50a7667c8f1811", "latest"]
}

// Get latest block number
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "eth_blockNumber"
}

// Get block by number
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "eth_getBlockByNumber",
  "params": ["0x1396d66", true]
}
```

---

## 7. Building the Web-Based Wallet (React)

### Project: OptiMask Wallet ü¶ä

A MetaMask-like wallet built with React + ethers.js + Alchemy API.

**Live Demo**: https://optimask-wallet-chi.vercel.app/  
**Similar references**: https://wallet-kosh.vercel.app/

### Setup Steps

**Step 1 ‚Äî Init Vite React project**
```bash
npm create vite@latest
```

**Step 2 ‚Äî Install dependencies**
```bash
npm install
```

**Step 3 ‚Äî Add node-polyfills** (needed for crypto libs in browser)
```bash
npm install vite-plugin-node-polyfills
```

```js
// vite.config.js
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import { nodePolyfills } from 'vite-plugin-node-polyfills'

export default defineConfig({
  plugins: [react(), nodePolyfills()],
})
```

**Step 4 ‚Äî Clean up App.jsx**
```jsx
import { useState } from 'react'
import './App.css'

function App() {
  const [count, setCount] = useState(0)
  return (<> </>)
}

export default App
```

### Mnemonic Generation

```bash
npm install bip39
```

```jsx
import { generateMnemonic } from 'bip39';

const [mnemonic, setMnemonic] = useState('');

<button onClick={async function() {
  const mn = await generateMnemonic();
  setMnemonic(mn);
}}>
  Create Seed Phrase
</button>

<input type="text" value={mnemonic} />
```

> Reference: https://github.com/rujulsong/web-bip39

### Solana Wallet Component

```jsx
import { useState } from 'react';
import { mnemonicToSeed } from 'bip39';
import { derivePath } from 'ed25519-hd-key';
import { Keypair } from '@solana/web3.js';
import nacl from 'tweetnacl';

export function SolanaWallet({ mnemonic }) {
  const [currentIndex, setCurrentIndex] = useState(0);
  const [publicKeys, setPublicKeys] = useState([]);

  return (
    <div>
      <button onClick={function() {
        const seed = mnemonicToSeed(mnemonic);
        const path = `m/44'/501'/${currentIndex}'/0'`;
        const derivedSeed = derivePath(path, seed.toString('hex')).key;
        const secret = nacl.sign.keyPair.fromSeed(derivedSeed).secretKey;
        const keypair = Keypair.fromSecretKey(secret);
        setCurrentIndex(currentIndex + 1);
        setPublicKeys([...publicKeys, keypair.publicKey]);
      }}>
        Add Wallet
      </button>
      {publicKeys.map(p => <div>{p.toBase58()}</div>)}
    </div>
  );
}
```

### ETH Wallet Component

```jsx
import { useState } from 'react';
import { mnemonicToSeed } from 'bip39';
import { Wallet, HDNodeWallet } from 'ethers';

export const ETHWallet = ({ mnemonic }) => {
  const [currentIndex, setCurrentIndex] = useState(0);
  const [addresses, setAddresses] = useState([]);

  return (
    <div>
      <button onClick={async function() {
        const seed = await mnemonicToSeed(mnemonic);
        const derivationPath = `m/44'/60'/${currentIndex}'/0'`;
        const hdNode = HDNodeWallet.fromSeed(seed);
        const child = hdNode.derivePath(derivationPath);
        const privateKey = child.privateKey;
        const wallet = new Wallet(privateKey);
        setCurrentIndex(currentIndex + 1);
        setAddresses([...addresses, wallet.address]);
      }}>
        Add ETH Wallet
      </button>
      {addresses.map((p) => (
        <div>
          Eth - {p}
        </div>
      ))}
    </div>
  );
};
```

---

## Key Concepts Summary

| Concept | Description |
|---------|-------------|
| Keccak-256 | Hashing algorithm used to derive ETH addresses from public keys |
| JSON-RPC | Protocol used to communicate with blockchain nodes |
| RPC Server | Intermediary service between your app and the blockchain |
| Wei | Smallest ETH unit (10^-18 ETH) |
| Lamport | Smallest SOL unit (10^-9 SOL) |
| HD Wallet | Hierarchical Deterministic wallet ‚Äî one seed, many accounts |
| Derivation Path | `m/44'/60'/index'/0'` (ETH) / `m/44'/501'/index'/0'` (SOL) |
| Alchemy | RPC provider used in this project for ETH RPC calls |

---

## References

- DailyCode track: https://projects.100xdevs.com/tracks/web-wallet-rpc/
- ethers.js docs: https://docs.ethers.org/
- Solana web3.js docs: https://solana-labs.github.io/solana-web3.js/
- bip39 npm: https://github.com/rujulsong/web-bip39
- Keccak-256 tool: https://emn178.github.io/online-tools/keccak_256.html
- JSON-RPC spec: https://www.jsonrpc.org/specification
