# 8.1 - Solana Blockchain Deep Dive, Token Program, PDAs & DApps

> **Course**: 100xDevs Cohort 3.0 — Web3 Track
> **Instructor**: Harkirat Singh
> **Week**: 8.1 + 8.0.1 (offline)
> **Notes (8.1)**: https://feather-lion-ff2.notion.site/Week-8-1-9a827a2082e247bf8651e4e41284752f
> **Notes (8.0.1 offline)**: https://feather-lion-ff2.notion.site/Week-8-0-1-offline-107246afc9f28026a17bc87acf4f6e98

---

## Topics Covered Today

**Week 8.1:**
1. Solana Blockchain — the big picture (lockers analogy)
2. Token Program — vending machine for digital coins
3. Mint Account — the coin factory
4. Difference between ATA vs Mint (with Indian currency analogy)
5. PDAs — mailbox analogy, how they work
6. How data is stored in Web3 vs Web2
7. Uber app problem in Solana world — PDAs as the solution

**Week 8.0.1 (offline):**
1. DApp — what it is, real-life examples
2. Solana Wallet Adapter — bicycle rental analogy
3. Creating a DApp in React — full code walkthrough

---

## Part 1: Solana Blockchain — The Big Picture

### The Lockers Analogy

Imagine the Solana blockchain is like a **giant library**, but instead of books, it has **millions of lockers**. Each locker belongs to different people, and inside these lockers, people can store things like tokens (think of them as digital coins) or information (like contracts).

### The Players (People and Programs)

- **Accounts (Lockers)**: In Solana, these lockers are called accounts, and they belong to users (you, me, and anyone else) or to programs (apps, businesses)
- **Programs (Apps or Services)**: Programs are like apps. Think of Uber — a ride-sharing app which connects drivers with people who need rides. In Solana, these programs can interact with accounts

### Diagram Breakdown

1. **System Program**: This is like the "bank" that helps you open your wallet (locker). "Harkirat's SOL wallet" and "Raman's SOL wallet" are like their personal lockers
2. **Uber Program**: Think of this as the actual Uber app on your phone, except it's running on Solana. The Uber Program can create accounts for different rides. "Ride 1 acc" is for one Uber ride, and "Ride 2 acc" is for another
3. **Token Program**: This program is like a special coin machine. It creates tokens (digital coins) for users. "Mint account" is like the main vault that creates tokens, and "User 1 ATA" and "User 2 ATA" are the personal coin lockers for User 1 and User 2

### Real-Life Example

- Imagine you're using Uber. You and your friend Harkirat both have wallets (lockers) where you store money
- When you request a ride, Uber creates a special ride locker for that trip, where all the ride info is stored
- After the ride, money (tokens) from your wallet is transferred to the driver. The Uber program, which is like the app, controls everything **without needing a bank or any middleman**

> In summary: Solana is like a huge library of lockers, where everyone stores their own coins or information, and programs like Uber can use these lockers to do business.

---

## Part 2: Token Program

The **Token Program** is like a **vending machine** that creates and manages digital coins (tokens). These tokens can be used in different ways, like paying for things in a game or trading with other players.

### Breaking it Down with the Diagram

1. **Mint Account (The Coin Machine)**: This is the place where tokens (coins) are created. Think of it like the machine that produces tokens for a video game — it's the source of all tokens
2. **User 1 ATA & User 2 ATA (Player's Coin Wallets)**: These are like wallets or pockets where users keep their tokens. ATA stands for **Associated Token Account** — the account where each user stores their game tokens

### Real-Life Example

Imagine you're playing a game where you earn coins (tokens) for winning races:
- The **Mint Account** is the machine that gives out coins to players when they win a race
- **User 1** gets some coins after winning → those coins go into **User 1 ATA**
- **User 2** wins → coins go into **User 2 ATA**

The **Token Program** manages everything — from creating the tokens in the Mint Account to putting the right amount of tokens in each player's wallet.

### In Simple Words

The Token Program is like a system that:
- **Creates** digital coins (tokens) in the **Mint Account** (like a coin machine)
- **Sends** those tokens to people's wallets (such as **User 1 ATA** and **User 2 ATA**)
- **Keeps track** of how many tokens each person has and allows them to use those tokens in different programs or games

> It's like a super smart coin machine that knows how to create, send, and keep track of all the tokens!

---

## Part 3: Mint Account

The **Mint Account** is like the **coin factory** in the Solana world. Whenever someone wants to create new tokens (digital coins), they need this Mint Account. It's the place where the tokens are born!

### Breaking it Down

1. **Mint Account (The Coin Factory)**: This is the special account where new tokens (coins) are created. When you want to make new tokens, the Mint Account is created first — just like setting up a machine in a factory to start producing coins
2. **User 1 ATA & User 2 ATA (Where the Coins Go)**: Once the tokens are made in the Mint Account, they are sent to users' wallets (ATAs). It's like shipping the coins from the factory to different people's pockets

### In Simple Words

- **Mint Account = Coin Factory**: It makes new tokens
- Once tokens are made, they go to different users' **wallets (ATAs)**
- You can think of the Mint Account as the place where **all new tokens are created before being distributed to people**

> It's basically a **factory** that produces and manages the creation of tokens!

---

## Part 4: Difference Between ATA vs Mint

### ATA (Associated Token Account)

- In Solana: An ATA is like a **wallet** that holds your specific tokens on the Solana blockchain. Every user has an ATA for each token they own, and it's created automatically by the system whenever needed
- **Real-Life Example (Indian Currency)**: Think of your ATA like your **bank account at the State Bank of India (SBI)**. Whenever you earn, deposit, or transfer money (Indian Rupees), your bank account automatically holds that money for you. You don't need to manually create a new bank account every time — you just use it to store and manage your Rupees
- On Solana: Your ATA is automatically created when you receive a specific token. If you get Solana tokens (SOL), your ATA is the place where those tokens are stored securely

### Mint Account

- In Solana: The Mint Account on Solana is the **factory** that creates new tokens. It controls the supply of tokens (like SOL or any other token) and is managed by the entity or program responsible for issuing them
- **Real-Life Example (Indian Currency)**: The **Reserve Bank of India (RBI)** is like the Mint Account. It prints new Rupees and controls how much currency is in circulation. The RBI decides when to print new money and sends it out to the banks — just like a Mint Account on Solana creates and sends new tokens to users
- On Solana: The Mint Account controls how many tokens are created. When a new token is introduced, the Mint Account issues these tokens to users' ATAs

### Diagram Explained

| | Mint Account | ATA |
|---|---|---|
| Executable | false | false |
| Data Size | **82 bytes** | **165 bytes** |
| Owner | Token Program | Token Program |
| Is a PDA | **No** | **Yes** |

- **Executable**: False for both — they are just **storage accounts** holding data or tokens
- **Data Size**: Mint Account uses 82 bytes (only holds token supply and properties). ATA uses 165 bytes (stores specific token data tied to an individual user)
- **Owner**: Both controlled by the **Token Program**
- **Is a PDA**: Mint Account is a **regular account** with a public/private key pair. ATA is a **Program Derived Address (PDA)** — created and managed by the Solana Program automatically, without needing a user to have a private key for it

### Key Differences — Indian Currency Example

- **ATA (Your Bank Account)**: Like your **SBI bank account** — where your Rupees are held and managed. It's created for you automatically, and you use it to store and access your money
- **Mint Account (RBI's Minting Facility)**: The **RBI minting facility** that prints new Rupees and decides how much new currency is created and distributed. The Mint Account on the blockchain creates new tokens and controls their supply

### In Simple Terms

- **ATA holds your tokens** (like a bank account holds your Rupees)
- **Mint Account creates the tokens** (like the RBI prints new Rupees)

---

## Part 5: PDA (Program Derived Address)

A **Program Derived Address (PDA)** is a type of account on the Solana blockchain that is associated with and owned by a program rather than a specific user or account.

> Think of it like a **unique mailbox that can only be opened by a specific program**.

### Understanding PDAs

1. **Mailbox Analogy**: Imagine you have a mailbox at a post office. Anyone can send letters to that mailbox, but only you have the key to open it. In the PDA world, only the **program** has the key
2. **Program Specific**: In Solana, a PDA is created by a program (like a smart contract). It means that only that program can access the information stored there
3. **No Private Key**: Unlike regular wallets, PDAs don't have a private key that a person controls. Instead, the program itself can access the data at that address
4. **Useful for Security**: PDAs help keep data secure and organized, as only the program can manage the information without needing a traditional user's key

> PDAs are like special mailboxes that only programs can access, making them handy for organizing and securing data on the blockchain!

### How PDAs Work

PDAs are generated **deterministically** — the same inputs will always create the same address. They are created using:

1. **User-defined seeds**: These can be anything — your wallet address, a string, or even a number
2. **A bump seed**: An extra number added to make sure the derived address isn't already used as a regular wallet address
3. **Program ID**: Every smart contract (like the Token Program) on Solana has its own unique ID — this ID is also part of the formula to generate a PDA

> The result is a unique PDA that the program controls, not a regular wallet with a public/private key pair. Only the program (in this case, the token program) can sign for transactions or interact with this PDA.

---

## Part 6: How Data is Stored in Web3

In **Web2**, data is typically stored in databases like **SQL** (structured tables with rows and columns) or **NoSQL** (flexible data storage, like key-value pairs). But in **Web3** — especially on blockchains like Solana — data is stored differently.

So, while Web2 uses **databases** (SQL/NoSQL), Web3 (Solana) uses **accounts on the blockchain** to store and manage data, and these accounts interact with **smart contracts** (like the Token Program) to ensure everything runs smoothly.

### Understand through Diagram

```
User Balances
┌───────────────┬────────────────────┬──────────────┐
│  Token Mint   │      Address       │ Token Amount │
├───────────────┼────────────────────┼──────────────┤
│     USDC      │  harkirats address │     100      │
│    DOGGY      │   ramans address   │     140      │
│     USDT      │   jyotis address   │     200      │
│     BONK      │  poonams address   │     400      │
└───────────────┴────────────────────┴──────────────┘
```

1. **Token Mint**: Represents the Mint Account (the factory that created a specific token, like USDC or BONK)
2. **Address**: This is the ATA (Associated Token Account) for each user — where each user's tokens are stored
3. **Token Amount**: The number of tokens stored in each user's ATA

### Real-Life Example (Bank System)

Imagine the Mint Account as the **Reserve Bank of India (RBI)**:
- The RBI prints and controls the Rupees (or tokens like USDC, DOGGY)
- The ATA (Associated Token Account) is your **bank account at SBI**
- The token amount is like the **balance** in each person's bank account

For example:
- **USDC Mint** creates and controls the supply of USDC tokens, like the RBI prints Rupees
- **Harkirat's ATA** is their personal account, where they have **100 USDC tokens** stored

Instead of a centralized SQL/NoSQL database, everything is stored on the **blockchain** as decentralized accounts, and the **Token Program** ensures these accounts are correctly managed.

---

## Part 7: Uber App Problem in Solana World

Suppose you create an Uber app — you won't expect users to remember the private key of every ride account. It would also become very difficult to track all the rides if they were random addresses.

### Problem Without PDAs

In an Uber-like app, if every ride created a new random account with its own private key, users would have to remember and manage keys for each ride — which would be confusing and hard to track.

### Solution with PDAs

PDAs (Program Derived Addresses) solve this by **creating predictable addresses** without needing private keys. The app can derive unique addresses for each ride based on the user's account and ride info, making it easy to track without extra keys.

### Real-Life Example (Uber Ride Tracking)

- **Without PDAs**: Every ride is like getting a new random locker at a bank, and you need a new key for each one
- **With PDAs**: The system (app) assigns you a specific locker (account) based on your user ID and ride details, so you only need your main key, and the system automatically manages your rides

> In short, **PDAs make managing multiple accounts (like rides) easier and more organized**, removing the need for users to remember lots of private keys.

---

## Part 8: DApp (Decentralized Application)

A **DApp** (decentralized application) is like an app you use on your phone or computer, but it runs on a blockchain instead of a central server. This means it's **not controlled by one company or person**.

### Real-Life Examples

1. **Uniswap**: Imagine a farmer's market where people trade fruits directly with each other. Uniswap is like that market for cryptocurrencies. You can swap one coin for another without needing a bank or middleman — just connect your digital wallet and you're good to go
2. **OpenSea**: Think of this as an art gallery but for digital art (NFTs). Anyone can buy or sell art pieces directly without needing a gallery owner. You connect your wallet to make a purchase, and the art is transferred to you

### How DApps Work

- **Smart Contracts**: Like vending machines. You put in money and select a product, and the machine gives it to you. In DApps, smart contracts handle transactions automatically based on rules coded into them
- **Wallets**: You need a digital wallet to use DApps, just like you need a physical wallet to carry cash. Your wallet keeps your private keys safe — like secret passwords that let you access your money

### Why Use DApps

- **Transparency**: Everyone can see transactions on a blockchain — this builds trust
- **Control**: You own your digital assets. No one can take them away from you like a bank might freeze your account
- **Censorship Resistance**: It's hard to shut down a DApp. They can keep running even if some people don't like them

> A DApp is like a marketplace or gallery that runs on the internet but is powered by blockchain technology. You use your wallet to trade or buy things directly, without needing a middleman. It's safe, transparent, and gives you control!

---

## Part 9: Solana Wallet Adapter

The **Solana Wallet Adapter** is a tool that connects your digital wallet to decentralized applications (DApps) on the Solana blockchain, allowing you to easily interact with them.

### Real-Life Example: Renting a Bicycle

1. **The Rental Shop (DApp)**: The rental shop represents a decentralized application where you can interact with services — like trading cryptocurrencies or buying digital assets
2. **Your Wallet (Membership Card)**: Your digital wallet is like a membership card that identifies you and stores your rental credits (cryptocurrency). It's where your value is kept
3. **The Wallet Adapter (Key Fob)**: The Solana Wallet Adapter acts like a key fob that allows you to unlock the bike rental service. It helps your membership card connect to the rental shop's system

### How It Works Together

1. **Checking In**: When you arrive at the rental shop, you need to check in with your membership card → similar to clicking "Connect Wallet" on a DApp website
2. **Signing Up**: To rent a bike, you might need to sign a rental agreement → in the digital world, this is like signing a transaction through your wallet
3. **Renting the Bike**: Once you sign the agreement, the shop confirms your rental → your transaction is processed and you can now use the services
4. **Returning the Bike**: After your ride, you return the bike and check out → you complete transactions on the DApp and return to your wallet to see your updated balance

### Why Use the Wallet Adapter?

- **Ease of Use**: Just like the key fob makes it easy to access the rental service, the Wallet Adapter simplifies connecting your wallet to various DApps
- **Compatibility**: It works with multiple wallets, allowing you to use whichever wallet you prefer — much like how different key fobs can access the same rental shop

---

## Part 10: Creating a DApp in React

### Initialise a React Project

```bash
npm create vite@latest
# Project name: week-5-dapp
# Select framework: React
# Select variant: JavaScript

cd week-5-dapp
npm install
npm run dev
```

### Clean up App.jsx

```jsx
import './App.css'

function App() {
  return (
    <>
    </>
  )
}

export default App
```

### Add Dependencies

```bash
npm install --save \
    @solana/wallet-adapter-base \
    @solana/wallet-adapter-react \
    @solana/wallet-adapter-react-ui \
    @solana/wallet-adapter-wallets \
    @solana/web3.js \
    react
```

### Flow of our DApp

The DApp shows:
- Left panel: **Connect** button (WalletMultiButton)
- Right panel: Amount input + **Send** button

On first load → user sees connect button → click shows all installed wallets → click on wallet → popup to grant permission (DApp gets **public key** but NOT private key)

### App.jsx — Full Setup

```jsx
import React, { useMemo } from 'react';
import { ConnectionProvider, WalletProvider } from '@solana/wallet-adapter-react';
import { WalletAdapterNetwork } from '@solana/wallet-adapter-base';
import {
  WalletModalProvider,
  WalletDisconnectButton,
  WalletMultiButton
} from '@solana/wallet-adapter-react-ui';
import { clusterApiUrl } from '@solana/web3.js';
import '@solana/wallet-adapter-react-ui/styles.css';
import { SendTokens } from './SendTokens';
import { SignMessage } from './SignMessage';

function App() {
  const network = WalletAdapterNetwork.Devnet;
  const endpoint = useMemo(() => clusterApiUrl(network), [network]);

  return (
    <ConnectionProvider endpoint={endpoint}>
      <WalletProvider wallets={[]} autoConnect>
        <WalletModalProvider>
          <div style={{ display: 'flex', justifyContent: 'space-between' }}>
            <WalletMultiButton />
            <WalletDisconnectButton />
          </div>
          {/* <RequestAirdrop /> */}
          {/* <ShowSolBalance /> */}
          {/* <Tokens /> */}
          <SignMessage />
          <SendTokens />
        </WalletModalProvider>
      </WalletProvider>
    </ConnectionProvider>
  );
}

export default App
```

### RequestAirdrop.jsx

```jsx
import { useWallet } from "@solana/wallet-adapter-react";
import { useConnection } from "@solana/wallet-adapter-react";
import { LAMPORTS_PER_SOL } from "@solana/web3.js";

export function RequestAirdrop() {
  const wallet = useWallet();
  const { connection } = useConnection();

  async function requestAirdrop() {
    let amount = document.getElementById("amount").value;
    await connection.requestAirdrop(wallet.publicKey, amount * LAMPORTS_PER_SOL);
    alert("Airdropped " + amount + " SOL to " + wallet.publicKey.toBase58());
  }

  return (
    <div>
      <br/><br/>
      <input id="amount" type="text" placeholder="Amount" />
      <button onClick={requestAirdrop}>Request Airdrop</button>
    </div>
  );
}
```

### SendTokens.jsx

```jsx
import { useConnection, useWallet } from "@solana/wallet-adapter-react"
import { LAMPORTS_PER_SOL, PublicKey, SystemProgram, Transaction } from "@solana/web3.js";

export function SendTokens() {
  const wallet = useWallet();
  const { connection } = useConnection();

  async function sendTokens() {
    let to = document.getElementById("to").value;
    let amount = document.getElementById("amount").value;
    const transaction = new Transaction();
    transaction.add(SystemProgram.transfer({
      fromPubkey: wallet.publicKey,
      toPubkey: new PublicKey(to),
      lamports: amount * LAMPORTS_PER_SOL,
    }));
    await wallet.sendTransaction(transaction, connection);
    alert("Sent " + amount + " SOL to " + to);
  }

  return (
    <div>
      <input id="to" type="text" placeholder="To" />
      <input id="amount" type="text" placeholder="Amount" />
      <button onClick={sendTokens}>Send</button>
    </div>
  );
}
```

### ShowSolBalance.jsx

```jsx
import { useConnection, useWallet } from "@solana/wallet-adapter-react";
import { LAMPORTS_PER_SOL } from "@solana/web3.js";

export function ShowSolBalance() {
  const { connection } = useConnection();
  const wallet = useWallet();

  async function getBalance() {
    if (wallet.publicKey) {
      const balance = await connection.getBalance(wallet.publicKey);
      document.getElementById("balance").innerHTML = balance / LAMPORTS_PER_SOL;
    }
  }

  getBalance();
  return (
    <div>
      <p>SOL Balance: </p><div id="balance"></div>
    </div>
  );
}
```

### SignMessage.jsx

```jsx
import { ed25519 } from '@noble/curves/ed25519';
import { useWallet } from '@solana/wallet-adapter-react';
import bs58 from 'bs58';
import React from 'react';

export function SignMessage() {
  const { publicKey, signMessage } = useWallet();

  async function onClick() {
    if (!publicKey) throw new Error('Wallet not connected!');
    if (!signMessage) throw new Error('Wallet does not support message signing!');

    const message = document.getElementById("message").value;
    const encodedMessage = new TextEncoder().encode(message);
    const signature = await signMessage(encodedMessage);

    if (!ed25519.verify(signature, encodedMessage, publicKey.toBytes()))
      throw new Error('Message signature invalid!');
    alert('success', `Message signature: ${bs58.encode(signature)}`);
  };

  return (
    <div>
      <input id="message" type="text" placeholder="Message" />
      <button onClick={onClick}>
        Sign Message
      </button>
    </div>
  );
}
```

---

## Summary

**Week 8.1:**
- The Solana blockchain is like a giant library of lockers (accounts) where users store tokens, and programs (apps) interact with these accounts
- The **Token Program** creates and manages tokens through a **Mint Account** (coin factory) and stores them in users' **ATA** (wallets)
- **PDA** (Program Derived Address) simplifies account management by creating predictable addresses without needing private keys — making it easier for programs like Uber to track rides
- In Web3, data is stored in blockchain accounts rather than traditional databases, ensuring secure and decentralized management

**Week 8.0.1:**
- **DApps** operate on blockchains, independent of central control (examples: Uniswap, OpenSea)
- **Solana Wallet Adapter** connects wallets to Solana DApps, simplifying user interactions
- **DApp in React** includes components for requesting SOL, sending tokens, checking balance, and signing messages

---

## Key Concepts Table

| Concept | Description |
|---|---|
| Solana Blockchain | Giant library of lockers — each account stores tokens or program data |
| Token Program | Vending machine / coin system — creates, sends, tracks all tokens |
| Mint Account | Coin factory — creates new tokens, controls supply (82 bytes) |
| ATA | User's token wallet — holds specific token balances (165 bytes, is a PDA) |
| PDA | Deterministic address derived from seeds + programId, no private key |
| DApp | Decentralized app running on blockchain, not controlled by one entity |
| Wallet Adapter | Universal connector between your wallet and any Solana DApp |
| Smart Contract | Vending machine logic — auto-executes based on coded rules |
| WalletMultiButton | Pre-built connect button UI for Solana DApps |
| sendTransaction | Wallet signs + broadcasts transaction (triggers Phantom popup) |
| signMessage | Off-chain signature — proves wallet ownership without spending SOL |

---

## References

- Week 8.1 Notes: https://feather-lion-ff2.notion.site/Week-8-1-9a827a2082e247bf8651e4e41284752f
- Week 8.0.1 Notes: https://feather-lion-ff2.notion.site/Week-8-0-1-offline-107246afc9f28026a17bc87acf4f6e98
- Solana PDA Docs: https://solana.com/docs/core/pda
- Wallet Adapter Docs: https://github.com/anza-xyz/wallet-adapter
